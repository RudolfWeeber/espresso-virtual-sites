\documentclass[
a4paper,                        % paper size
11pt,                           % font size
twoside,                        % two sided
footsepline,                    % add a line to separate the footer
headsepline,                    % add a line to separate the header
headexclude,                    % header does not belong to the text
footexclude,                    % footer does not belong to the text
pagesize,                       % set the pagesize in a DVI document
bibtotocnumbered,               % add the bibliography to the TOC
idxtotoc                        % add the index to the TOC
%openright,                      % start a new chapter on the right page
%,DIV12
%,draft
]{scrreprt}

\usepackage{nameref}            % nameref, varioref, hyperref must be
                                % used in this order (see hyperref
                                % README)!
\usepackage[draft]{varioref}    % defines \vref
\usepackage[bookmarksopen=true]
{hyperref}                      % automatically creates links when
                                % using pdflatex, defines \url
\usepackage{ifpdf}              % defines \ifpdf
\usepackage{graphicx}           % handles graphics
\usepackage{makeidx}            % creates the index
\usepackage{color}              % use colors

\usepackage{verbatim}           % required for \verbatim and \endverbatim
\usepackage{alltt}              % almost verbatim environment (code)
\usepackage{tocloft}            % required for the quickref
\usepackage{calc}               % compute length
\usepackage{ifthen}             % provide ifthen

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% New Commands and Environments %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\es}{\mbox{\textsf{ESPResSo}}}
\newcommand{\ie}{\textit{i.e.\/}}
\newcommand{\eg}{\textit{e.g.\/}}
\newcommand{\etal}{\textit{et al.\/}}

\newcommand{\codebox}[1]%
{%
  \begingroup\setlength{\fboxsep}{1pt}%
  \fcolorbox[rgb]{0,0,0}{0.9,0.9,0.9}{\ttfamily#1}%
  \endgroup%
}

\newsavebox{\thecodebox}
\newenvironment{code}{
  \begin{lrbox}{\thecodebox}
    \begin{minipage}{\linewidth-2em}
      \begin{alltt}
      }{
      \end{alltt}
    \end{minipage}
  \end{lrbox}
  \smallskip
  \begin{addmargin}[1em]{0pt}
    \codebox{\usebox{\thecodebox}}
  \end{addmargin}
  \smallskip
}

\makeatletter
\newenvironment{tclcode}
{
  \addtolength{\linewidth}{-2em}% set the line length
  \@minipagetrue%%%DPC%%%
  \@tempswatrue%%%DPC%%%
  \hsize=\linewidth%
  \setbox0=\vbox\bgroup\verbatim
}{\endverbatim
  \unskip\setbox0=\lastbox%%%DPC%%%
  \egroup
  \par
  \smallskip
  \noindent
  \begin{addmargin}[1em]{0pt}
    \codebox{\box0}
  \end{addmargin}
  \par
  \smallskip
  \noindent
}
\makeatother


%%%%%%%%%%%%%% Syntax Description %%%%%%%%%%%%%%%

%%%%%% SYNTAX DEFININTION LAYOUT
% typesetting inside a command definition
% keywords/literals
\newcommand{\lit}[1]{\mbox{\texttt{#1}}}
\newcommand{\keyword}[1]{\mbox{\texttt{#1}}}
% variables
\newcommand{\var}[1]{\mbox{\textrm{\textit{#1}}}}
% option
\newcommand{\opt}[1]{\mbox{[#1]}}

% command definition
\newcommand{\tclcommand}[3][]{%
  \stepcounter{qrfcounter}
  \index{#2@\texttt{#2}|textbf}
  \index{Tcl-commands!#2@\texttt{#2}|textbf}
  \addtocontents{qrf}{\protect\qrfcommand{#1}{#2}{#3}{\thepage}{qrf\arabic{qrfcounter}}}
  \minisec{Syntax}
  \smallskip
  \hypertarget{qrf\arabic{qrfcounter}}{%
    \codebox{%
      #2
      \parbox[t]{0.9\linewidth-\widthof{#2}}%
      {\ttfamily\raggedright\mbox{}#3}
    }%
  }%
  \ifthenelse{\equal{#1}{}}{}{%
    \minisec{Required features}
    \texttt{#1}
  }
  \minisec{Description}
}


\newenvironment{arguments}{
  \minisec{Arguments}
  \begin{list}{}{
      \setlength{\rightmargin}{1em}
      \setlength{\leftmargin}{2em}
      \setlength{\partopsep}{0pt}
      \setlength{\topsep}{1ex}
      \setlength{\parsep}{0.5ex}
      \setlength{\listparindent}{1em}
      \setlength{\labelwidth}{0.5em}
      \setlength{\labelsep}{0.5em}
      \renewcommand{\makelabel}[1]{\codebox{##1}}
    }
  }{
  \end{list}
}

\newcommand{\addtoquickref}[1]{\addtocontents{qrf}{#1}}
\newcommand{\quickrefheading}[1]{%
  \stepcounter{qrfcounter}
  \addtocontents{qrf}{\protect\qrfheading{#1}{\thepage}{qrf\arabic{qrfcounter}}}
  \hypertarget{qrf\arabic{qrfcounter}}{}
}


%%%%% QUICK REFERENCE LAYOUT
% Create quick reference list
\newlistof{commands}{qrf}{}
\newcommand{\qrflastpage}{} % save the last page number
\newcounter{qrfcounter} % the current number of the cmd

\makeatletter
\newcommand{\qrfheading}[3]{
  \@dottedtocline{1}{0pt}{0pt}{\hyperlink{#3}{\textsf{\textbf{#1}}}}{#2}
  \renewcommand{\qrflastpage}{#2}%
}
\makeatother

% command definition in the quickref
\newcommand{\qrfcommand}[5]{%
  \begin{addmargin}[1em]{0pt}%
    \hyperlink{#5}{%
      \ttfamily
      #2
      \parbox[t]{0.9\linewidth-\widthof{#2}}%
      {\raggedright #3}%
    }%
  % print the page number if it is differnet from the last entry
    \ifthenelse{\equal{\qrflastpage}{#4}}{}{\hfill\scriptsize #4}%
    \ifthenelse{\equal{#1}{}}{}{%
      \scriptsize\\\hspace*{1em} Required features: \texttt{#1}%
    }%
  \end{addmargin}%
  \ifthenelse{\equal{\qrflastpage}{#4}}{}{\renewcommand{\qrflastpage}{#4}}%
  \smallskip
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%% Other Settings %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pagestyle{headings}
\makeindex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%% Main Document %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\titlehead{
  \begin{center}
    \includegraphics[width=5cm]{figures/logo}
  \end{center}
}
%\subject{}
\title{\es{} User's Guide}
%\author{}
%\date{\today}
\maketitle

\pdfbookmark{Contents}{toc}
\tableofcontents

\include{introduction}

\include{firststeps}
\include{installation}
\include{setup}
\include{run}
\include{analysis}
\include{aux}
\include{internal}
\include{contributing}

\appendix
\include{quickref}
\include{features}

\chapter{The MMM family of algorithms}
\label{chap:mmm}

\chapter{Maggs algorithm}
\label{chap:maggs}

\printindex

\end{document}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
