\documentclass[
a4paper,                        % paper size
11pt,                           % font size
twoside,                        % two sided
footsepline,                    % add a line to separate the footer
headsepline,                    % add a line to separate the header
headexclude,                    % header does not belong to the text
footexclude,                    % footer does not belong to the text
pagesize,                       % set the pagesize in a DVI document
bibtotocnumbered,               % add the bibliography to the TOC
idxtotoc                        % add the index to the TOC
%openright,                      % start a new chapter on the right page
%,DIV12
%,draft
]{scrreprt}

\usepackage[draft]{varioref}    % defines \vref
\usepackage{hyperref}                      % automatically creates links when
                                % using pdflatex, defines \url
\usepackage{ifpdf}              % defines \ifpdf
\usepackage{graphicx}           % handles graphics
\usepackage{makeidx}            % creates the index
\usepackage{color}              % use colors

\usepackage{amsmath}

\usepackage{verbatim}           % required for \verbatim and \endverbatim
\usepackage{fancyvrb}
\usepackage{tocloft}            % required for the quickref
\usepackage{calc}               % compute length
\usepackage{ifthen}             % provide ifthen
\usepackage{xspace}
\usepackage{units}
\usepackage[numbers]{natbib}

% Make '_' a normal character (from http://www.tug.org/TeXnik/mainFAQ.cgi)
\usepackage{underscore}
% \begingroup
%   \lccode`\~=`\_
% \lowercase{\endgroup
%   \pdfstringdefDisableCommands{\let~\relax}%
% }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% New Commands and Environments %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\es}{\mbox{\textsf{ESPResSo}}\xspace}
\newcommand{\ie}{\textit{i.e.}\xspace}
\newcommand{\eg}{\textit{e.g.}\xspace}
\newcommand{\etal}{\textit{et al.}\xspace}

\newcommand{\codebox}[1]%
{\texttt{#1}}

\DefineVerbatimEnvironment{code}{Verbatim}%
{commandchars=\\\{\}}
\makeatletter
\newenvironment{tclcode}
{%
  \addtolength{\linewidth}{-2em}% set the line length
  \@minipagetrue%%%DPC%%%
  \@tempswatrue%%%DPC%%%
  \hsize=\linewidth%
  \setbox0=\vbox\bgroup\verbatim
}{\endverbatim
  \unskip\setbox0=\lastbox%%%DPC%%%
  \egroup
  \par%
  \noindent\hspace{1em}%
  \codebox{\box0}%
  \par\noindent%
}
\makeatother

% required so that we can set index numbers bold
% \index{Some example|mainindex}
\newcommand*{\mainindex}[1]{\textbf{\hyperpage{#1}}}

\newcommand{\todo}[1]{
  \marginpar{%
    \setlength{\fboxrule}{1pt}
    \fcolorbox{red}{yellow}{%
      \parbox{\marginparwidth-2\fboxrule-2\fboxsep}{%
        \bf\raggedright\scriptsize #1%
      }%
    }%
  }%
}

\makeatletter
\renewcommand{\minisec}[1]{\@afterindentfalse \vskip 1.5ex
  {\parindent \z@
    \raggedsection\normalfont\sffamily\itshape\nobreak#1\par\nobreak}%
  \@afterheading}
\makeatother

%%%%%%%%%%%%%% Syntax Description %%%%%%%%%%%%%%%

%%%%%% SYNTAX DEFINITION LAYOUT
%% Defines environments and commands to be used when defining the
%% syntax of a Tcl command.
% typesetting inside a command definition
% keywords/literals
\newcommand{\lit}[1]{\mbox{\texttt{#1}}}
\newcommand{\keyword}[1]{\mbox{\texttt{#1}}}
% variables
\newcommand{\var}[1]{\ensuremath{\mathrm{\mathit{#1}}}}
% option
\newcommand{\opt}[1]{\mbox{\textrm{[}#1\textrm{]}}}
\newcommand{\optlong}[1]{\textrm{[}#1\textrm{]}}
% alternatives
\newcommand{\alt}[1]{\textrm{(} #1 \textrm{)}}
\newcommand{\asep}{$|$\xspace}
% variant
% \rawvariant is required, as the command is changed during the
% essyntax environment
\newcommand{\rawvariant}[1]{\mbox{\textnormal{(#1)}}\xspace}
\newcommand{\variant}[1]{\rawvariant{#1}}
\newcommand{\fmark}[1]{%
  \raisebox{1ex}{%
    \textrm{\footnotesize #1}%
  }%
}
% feature
\newcommand{\feature}[1]{\texttt{\MakeUppercase{#1}}}

\newcommand{\require}[2]{%
  \mbox{#2\,\fmark{#1}}%
}
\newcommand{\required}[2][]{%
  \ifthenelse{\equal{#1}{}}{#2}{%
    \mbox{\fmark{#1}\,\feature{#2}}%
  }
}
\newenvironment{features}{%
  \par\smallskip%
  \small%
  \textrm{Required\hspace{1ex}features:}%
  \raggedright%
}{}

%% Layout thesyntax description box
\newsavebox{\theessyntaxbox}
\newlength{\essyntaxboxheight}
\newlength{\essyntaxboxdepth}
\newenvironment{essyntaxbox}{%
  \par\noindent%
 \begin{lrbox}{\theessyntaxbox}%
   \begin{minipage}{\linewidth-5em}%
     \ttfamily%
     \setlength{\parindent}{-3em}%
   }{%
   \end{minipage}%
 \end{lrbox}%
 \settoheight{\essyntaxboxheight}{\usebox{\theessyntaxbox}}%
 \settodepth{\essyntaxboxdepth}{\usebox{\theessyntaxbox}}%
 \hspace{1.5em}%
 \rule[-\essyntaxboxdepth]{1pt}{\essyntaxboxheight+\essyntaxboxdepth}%
 \hspace{3.5em}%
 \usebox{\theessyntaxbox}%
}

%% Environment for syntax descriptions
\newcounter{essyntaxcounter}
\setcounter{essyntaxcounter}{0}
\newenvironment{essyntax}{%
  \stepcounter{essyntaxcounter}%
  \label{essyntax:\arabic{essyntaxcounter}}
  % Create headings
  \minisec{Syntax}\nopagebreak%
  \smallskip\nopagebreak%
  \renewcommand{\variant}[1]{\par\rawvariant{##1}}
  \begin{essyntaxbox}%
  }{%
  \end{essyntaxbox}%
  \renewcommand{\variant}[1]{\rawvariant{##1}}
  \minisec{Description}%
}
% Define the starred environment (identical to unstarred, only it is
% not copied to the Quick reference)
\newenvironment{essyntax*}{\essyntax}{\endessyntax}

%% List-environment for the description of the arguments of a command
\newenvironment{arguments}{
  \minisec{Arguments}
  \begin{list}{}{
      \setlength{\rightmargin}{1em}
      \setlength{\leftmargin}{2em}
      \setlength{\partopsep}{0pt}
      \setlength{\topsep}{1ex}
      \setlength{\parsep}{0.5ex}
      \setlength{\listparindent}{-1em}
      \setlength{\labelwidth}{0.5em}
      \setlength{\labelsep}{0.5em}
      \renewcommand{\makelabel}[1]{\textbullet\,\texttt{##1}}
    }
  }{
  \end{list}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Declare new features/commands/analyze subcommands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Feature declaration
\newcommand{\newfeature}[1]{%
  \index{features!{\scriptsize #1}|mainindex}%
  \hypertarget{#1}{\texttt{\textbf{#1}}}%
}

% Create label and index entries for an Espresso tcl command
\newcommand{\newescommand}[2][NONE]{%
  \ifthenelse{\equal{#1}{NONE}}%
  {\label{tcl:#2}}%
  {\label{tcl:#1}}%
  \index{#2@\texttt{#2} (Tcl-command)|mainindex}%
  \index{Tcl-commands!#2@\texttt{#2}|mainindex}%
}

% Create index entries for analysis functions
\newcommand{\analyzeindex}[1]{%
  \index{#1|mainindex}%
  \index{analysis!#1|mainindex}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%% Other Settings %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeindex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%% Main Document %%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\titlehead{
  \begin{center}
    \includegraphics[width=5cm]{figures/logo}
  \end{center}
}
%\subject{}
\title{\es{} User's Guide}
%\author{}
%\date{\today}
\maketitle

\pdfbookmark{Contents}{toc}
\tableofcontents

\include{introduction}

\include{firststeps}
\include{installation}

\include{part}
\include{inter}
\include{setup}
\include{run}
\include{analysis}
\include{io}
\include{aux}

\include{internal}
\include{contributing}

\appendix
\include{quickref}
\include{features}
\include{examples}
\include{deserno}

%% Scientific appendices: description of algorithms
\include{mmm}
\chapter{Maggs algorithm}
\label{chap:maggs}

\bibliographystyle{plainnat}
\bibliography{bibliography}

\printindex

\end{document}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
